#!/usr/bin/env bash
set -eux
for example in stdin stdin_actix; do
    {
        sleep 0.01
        cat tests/test_input.txt
    } | cargo run --example "${example}" | diff -u tests/test_output.txt -
    cargo run --example "${example}" </dev/null | tail -n +2 | diff -u /dev/null -
done
cat tests/test_actix_web_input.txt | cargo run --example stdin_actix_web | diff -u tests/test_actix_web_output.txt -
cargo run --example stdin_actix_web </dev/null | tail -n +2 | diff -u /dev/null -

cargo run --example seek
diff -q tests/seek.txt <(echo aaccccAAbbbbbbbb)
